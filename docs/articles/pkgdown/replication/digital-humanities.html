<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Replication: Text Analysis with R for Students of Literature • quanteda</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../../bootstrap-toc.css">
<script src="../../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../../pkgdown.css" rel="stylesheet">
<script src="../../../pkgdown.js"></script><!-- docsearch --><script src="../../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../../../extra.css" rel="stylesheet">
<script src="../../../extra.js"></script><meta property="og:title" content="Replication: Text Analysis with R for Students of Literature">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-0F398Z98L1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0F398Z98L1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../../index.html">quanteda</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Quick Start

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/quickstart.html">Quick Start Guide</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_es.html">Guía de Inicio Rápido</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_cn.html">快速入门指南</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_ja.html">クイック・スタートガイド</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_hi.html">त्वरित आरंभ </a>
    </li>
  </ul>
</li>
<li>
  <a href="../../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Features

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/parallelisation.html">Parallel computing</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/tokens_xptr.html">External pointer tokens objects</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/benchmarks_xptr.html">Performance benchmarks</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/design.html">Package design</a>
    </li>
    <li>
      <a href="../../../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Examples

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/examples/phrase.html">Multi-word expressions</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/plotting.html">Textual data visualization</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/lsa.html">Latent Semantic Analysis (LSA)</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/chinese.html">Chinese text analysis</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/twitter.html">Social media analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Replications

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/replication/digital-humanities.html">Text Analysis with R for Students of Literature</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/replication/text2vec.html">Word embedding (word2vec)</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/replication/qss.html">Quantitative Social Science Ch. 5.1</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/quanteda/quanteda" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>

    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Replication: Text Analysis with R for Students
of Literature</h1>
                        <h4 data-toc-skip class="author">Kenneth Benoit,
Stefan Müller, and Paul Nulty</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/quanteda/quanteda/blob/HEAD/vignettes/pkgdown/replication/digital-humanities.Rmd" class="external-link"><code>vignettes/pkgdown/replication/digital-humanities.Rmd</code></a></small>
      <div class="hidden name"><code>digital-humanities.Rmd</code></div>

    </div>

    
    
<p>In this vignette we show how the <strong>quanteda</strong> package
can be used to replicate the analysis from Matthew Jockers’ book <a href="http://doi.org/10.1007/978-3-319-03164-4" class="external-link"><em>Text Analysis with R
for Students of Literature</em></a> (London: Springer, 2014). Most of
the Jockers book consists of loading, transforming, and analyzing
quantities derived from text and data from text. Because
<strong>quanteda</strong> has built in most of the code to perform these
data transformations and analyses, it makes it possible to replicate the
results from the book with far less code. Throughout this vignette, we
name objects based on Jockers’ book, but follow the
<strong>quanteda</strong> <a href="https://github.com/quanetda/quanteda/wiki/Style-guide" class="external-link">style
guide</a>.</p>
<p>In what follows, each section corresponds to the respective chapter
in the book.</p>
<div class="section level2">
<h2 id="r-basics">1 R Basics<a class="anchor" aria-label="anchor" href="#r-basics"></a>
</h2>
<p>Our closest equivalent is simply:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"quanteda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"readtext"</span><span class="op">)</span></span></code></pre></div>
<p>But if you are reading this vignette, than chances are that you have
already completed this step.</p>
</div>
<div class="section level2">
<h2 id="first-foray">2 First Foray<a class="anchor" aria-label="anchor" href="#first-foray"></a>
</h2>
<div class="section level3">
<h3 id="loading-the-first-text-file">2.1 Loading the first text file<a class="anchor" aria-label="anchor" href="#loading-the-first-text-file"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://quanteda.io">"quanteda"</a></span><span class="op">)</span></span></code></pre></div>
<p>We can load the text from <em>Moby Dick</em> using the
<strong>readtext</strong> package, directly from the <a href="https://www.gutenberg.org/ebooks/2701" class="external-link">Project Gutenberg
website</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_char_mobydick</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu">readtext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/readtext/man/readtext.html" class="external-link">readtext</a></span><span class="op">(</span><span class="st">"http://www.gutenberg.org/cache/epub/2701/pg2701.txt"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_char_mobydick</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Moby Dick"</span></span></code></pre></div>
<p>The <code>readtext()</code> function from the
<strong>readtext</strong> package loads the text files into a
<code>data.frame</code> object. We can access the text from a
<code>data.frame</code> object (and also, as we will see, a
<code>corpus</code> class object). Here we will display just the first
75 characters, to prevent a massive dump of the text of the entire
novel. We do this using the <code><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html" class="external-link">stri_sub()</a></code> function from the
<strong>stringi</strong> package, which shows the 1st through the 75th
characters of the texts of our new object
<code>data_char_mobydick</code>. Because we have not assigned the return
from this command to any object, it invokes a print method for character
objects, and is displayed on the screen.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://stringi.gagolewski.com/" class="external-link">"stringi"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html" class="external-link">stri_sub</a></span><span class="op">(</span><span class="va">data_char_mobydick</span>, <span class="fl">1</span>, <span class="fl">75</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "The Project Gutenberg eBook of Moby Dick; Or, The Whale\n    \nThis ebook is "</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="separate-content-from-metadata">2.2 Separate content from metadata<a class="anchor" aria-label="anchor" href="#separate-content-from-metadata"></a>
</h3>
<p>The Gutenburg edition of the text contains some metadata before and
after the text of the novel. The code below uses the
<code>regexec</code> and <code>substring</code> functions to separate
this from the text.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract the header information</span></span>
<span><span class="op">(</span><span class="va">start_v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_locate.html" class="external-link">stri_locate_first_fixed</a></span><span class="op">(</span><span class="va">data_char_mobydick</span>, <span class="st">"CHAPTER 1. Loomings."</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 873</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">end_v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_locate.html" class="external-link">stri_locate_last_fixed</a></span><span class="op">(</span><span class="va">data_char_mobydick</span>, <span class="st">"orphan."</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1219670</span></span></code></pre>
<p>Here, we found the character index of the beginning and end of the
novel, rather than counting the lines as in the book, but the result
will be very similar. If we want to verify that “orphan.” is the end of
the novel, we can use the <code><a href="../../../reference/kwic.html">kwic()</a></code> function:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># verify that "orphan" is the end of the novel</span></span>
<span><span class="fu"><a href="../../../reference/kwic.html">kwic</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/tokens.html">tokens</a></span><span class="op">(</span><span class="va">data_char_mobydick</span><span class="op">)</span>, <span class="st">"orphan"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Keyword-in-context with 1 match.                                                                     </span></span>
<span><span class="co">##  [Moby Dick, 252772] children, only found another | orphan | .*** END</span></span></code></pre>
<p>If we want to count the number of lines, we can do so by counting the
newlines in the text.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_count.html" class="external-link">stri_count_fixed</a></span><span class="op">(</span><span class="va">data_char_mobydick</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 22314</span></span></code></pre>
<p>To measure just the number lines in the novel itself, without the
metadata, we can subset the text from the start and end of the novel
part, as identified above.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html" class="external-link">stri_sub</a></span><span class="op">(</span><span class="va">data_char_mobydick</span>, from <span class="op">=</span> <span class="va">start_v</span>, to <span class="op">=</span> <span class="va">end_v</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_count.html" class="external-link">stri_count_fixed</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 21917</span></span></code></pre>
<p>To trim the non-book content, we use <code><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html" class="external-link">stri_sub()</a></code> to
extract the text between the beginning and ending indexes found
above:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">novel_v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html" class="external-link">stri_sub</a></span><span class="op">(</span><span class="va">data_char_mobydick</span>, <span class="va">start_v</span>, <span class="va">end_v</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">novel_v</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html" class="external-link">stri_sub</a></span><span class="op">(</span><span class="va">novel_v</span>, <span class="fl">1</span>, <span class="fl">94</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## CHAPTER 1. Loomings.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## CHAPTER 2. The Carpet-Bag.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## CHAPTER 3. The Spouter-Inn.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## CHAPTER 4. The</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="reprocessing-the-content">2.3 Reprocessing the content<a class="anchor" aria-label="anchor" href="#reprocessing-the-content"></a>
</h3>
<p>We begin processing the text by converting to lower case.
<strong>quanteda</strong>’s <code>*_tolower()</code> functions work like
the built-in <code><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower()</a></code>, with an extra option to preserve
upper-case acronyms when detected. To work with the novel efficiently,
however, we will first tokenise it. Then, we can manipulate it using
functions such as <code><a href="../../../reference/tokens_tolower.html">tokens_tolower()</a></code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">novel_v_toks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/tokens.html">tokens</a></span><span class="op">(</span><span class="va">novel_v</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># lowercase text</span></span>
<span><span class="va">novel_v_toks_lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/tokens_tolower.html">tokens_tolower</a></span><span class="op">(</span><span class="va">novel_v_toks</span><span class="op">)</span></span></code></pre></div>
<p><strong>quanteda</strong>’s <code><a href="../../../reference/tokens.html">tokens()</a></code> function splits the
text into words, with many options available for which characters should
be preserved, and which should be used to define word boundaries. The
default behaviour works similarly to splitting on the regular expression
for non-word characters (<code>\W</code> as in the book), but it much
smarter. For instance, it does not treat apostrophes as word boundaries,
meaning that <code>'s</code> and <code>'t</code> are not treated as
whole words from possessive forms and contractions.</p>
<p>To remove punctuation, we can re-process the existing tokens:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">moby_word_v</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/tokens.html">tokens</a></span><span class="op">(</span><span class="va">novel_v_toks_lower</span>, remove_punct <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">total_length</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span><span class="op">(</span><span class="va">moby_word_v</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  text1 </span></span>
<span><span class="co">## 213374</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">moby_word_v</span><span class="op">[[</span><span class="st">"text1"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "chapter"    "1"          "loomings"   "chapter"    "2"         </span></span>
<span><span class="co">##  [6] "the"        "carpet-bag" "chapter"    "3"          "the"</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">moby_word_v</span><span class="op">[[</span><span class="st">"text1"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">99986</span><span class="op">]</span> </span></code></pre></div>
<pre><code><span><span class="co">## [1] "teeth"</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">moby_word_v</span><span class="op">[[</span><span class="st">"text1"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "chapter" "2"       "the"</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check positions of "whale"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">moby_word_v</span><span class="op">[[</span><span class="st">"text1"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"whale"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 166 275 291 333 500 566</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="beginning-the-analysis">2.4 Beginning the analysis<a class="anchor" aria-label="anchor" href="#beginning-the-analysis"></a>
</h3>
<p>The code below uses the tokenized text to the occurrence of the word
<em>whale</em>. To include the possessive form <em>whale’s</em>, we may
sum the counts of both forms, count the keyword-in-context matches by
regular expression or glob. A <em>glob</em> is a simple wildcard
matching pattern common on Unix systems – asterisks match zero or more
characters.</p>
<p>Note that the counts below do not match those in the book, due to
differences in how the book has split on any non-word character, while
<strong>quanteda</strong>’s tokenizer splits on a more comprehensive set
of “word boundaries”. <strong>quanteda</strong>’s <code><a href="../../../reference/tokens.html">tokens()</a></code>
function by default does not remove punctuation or numbers (both defined
as “non-word” characters) by default. To more closely match the counts
in the book, we have removed punctuation.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/tokens_select.html">tokens_select</a></span><span class="op">(</span><span class="va">moby_word_v</span>, <span class="st">"whale"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## text1 </span></span>
<span><span class="co">##   952</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># total occurrences of "whale" including possessive</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/tokens_select.html">tokens_select</a></span><span class="op">(</span><span class="va">moby_word_v</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"whale"</span>, <span class="st">"whale's"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## text1 </span></span>
<span><span class="co">##   952</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># same thing using kwic()</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/kwic.html">kwic</a></span><span class="op">(</span><span class="va">novel_v_toks_lower</span>, pattern <span class="op">=</span> <span class="st">"whale"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 952</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/kwic.html">kwic</a></span><span class="op">(</span><span class="va">novel_v_toks_lower</span>, pattern <span class="op">=</span> <span class="st">"whale*"</span><span class="op">)</span><span class="op">)</span> <span class="co"># includes words like "whalemen"</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1676</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">total_whale_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/kwic.html">kwic</a></span><span class="op">(</span><span class="va">novel_v_toks_lower</span>, pattern <span class="op">=</span> <span class="st">"^whale('s){0,1}$"</span>, valuetype <span class="op">=</span> <span class="st">"regex"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 952</span></span></code></pre>
<p>What fraction of the total words (excluding punctuation) in the novel
are “whale”?</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">total_whale_hits</span> <span class="op">/</span> <span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span><span class="op">(</span><span class="va">novel_v_toks_lower</span>, remove_punct <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  </span></code></pre></div>
<pre><code><span><span class="co">##       text1 </span></span>
<span><span class="co">## 0.004461649</span></span></code></pre>
<p>With <code><a href="../../../reference/ntoken.html">ntype()</a></code> we can calculate the size of the vocabulary
– includes possessive forms, but excludes punctuation, symbols and
numbers.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># total unique words</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">moby_word_v</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../../reference/ntoken.html">ntype</a></span><span class="op">(</span><span class="va">novel_v_toks_lower</span>, remove_punct <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## text1 </span></span>
<span><span class="co">## 19975</span></span></code></pre>
<p>To quickly sort the word types by their frequency, we can use the
<code><a href="../../../reference/dfm.html">dfm()</a></code> command to create a matrix of counts of each word
type – a document-frequency matrix. In this case there is only one
document, the entire book.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ten most frequent words</span></span>
<span><span class="va">moby_dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/dfm.html">dfm</a></span><span class="op">(</span><span class="va">moby_word_v</span><span class="op">)</span></span>
<span><span class="va">moby_dfm</span></span></code></pre></div>
<pre><code><span><span class="co">## Document-feature matrix of: 1 document, 19,975 features (0.00% sparse) and 0 docvars.</span></span>
<span><span class="co">##        features</span></span>
<span><span class="co">## docs    chapter 1 loomings 2   the carpet-bag 3 spouter-inn 4 counterpane</span></span>
<span><span class="co">##   text1     308 3        2 2 14451          5 5           5 2           7</span></span>
<span><span class="co">## [ reached max_nfeat ... 19,965 more features ]</span></span></code></pre>
<p>Getting the list of the most frequent 10 terms is easy, using
<code><a href="https://quanteda.io/reference/textstat_frequency.html">textstat_frequency()</a></code>.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://quanteda.io">"quanteda.textstats"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://quanteda.io/reference/textstat_frequency.html">textstat_frequency</a></span><span class="op">(</span><span class="va">moby_dfm</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">##    feature frequency rank docfreq group</span></span>
<span><span class="co">## 1      the     14451    1       1   all</span></span>
<span><span class="co">## 2       of      6596    2       1   all</span></span>
<span><span class="co">## 3      and      6395    3       1   all</span></span>
<span><span class="co">## 4        a      4648    4       1   all</span></span>
<span><span class="co">## 5       to      4585    5       1   all</span></span>
<span><span class="co">## 6       in      4159    6       1   all</span></span>
<span><span class="co">## 7     that      2941    7       1   all</span></span>
<span><span class="co">## 8      his      2523    8       1   all</span></span>
<span><span class="co">## 9       it      2389    9       1   all</span></span>
<span><span class="co">## 10       i      1960   10       1   all</span></span></code></pre>
<p>Finally, if we wish to plot the most frequent (50) terms, we can
supply the results of <code><a href="https://quanteda.io/reference/textstat_frequency.html">textstat_frequency()</a></code> to
<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code> to plot their frequency by their rank:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot frequency of 50 most frequent terms </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://quanteda.io/reference/textstat_frequency.html">textstat_frequency</a></span><span class="op">(</span><span class="va">moby_dfm</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rank</span>, y <span class="op">=</span> <span class="va">frequency</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Frequency rank"</span>, y <span class="op">=</span> <span class="st">"Term frequency"</span><span class="op">)</span></span></code></pre></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-18-1.png" width="768"></p>
<p>For direct comparison with the next chapter, we also create the
sorted list of the most frequently found words using this:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sorted_moby_freqs_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/topfeatures.html">topfeatures</a></span><span class="op">(</span><span class="va">moby_dfm</span>, n <span class="op">=</span> <span class="fu"><a href="../../../reference/ndoc.html">nfeat</a></span><span class="op">(</span><span class="va">moby_dfm</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="accessing-and-comparing-word-frequency-data">3 Accessing and Comparing Word Frequency Data<a class="anchor" aria-label="anchor" href="#accessing-and-comparing-word-frequency-data"></a>
</h2>
<div class="section level3">
<h3 id="accessing-word-data">3.1 Accessing Word Data<a class="anchor" aria-label="anchor" href="#accessing-word-data"></a>
</h3>
<p>We can query the document-frequency matrix to retrieve word
frequencies, as with a normal matrix:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># frequencies of "he" and "she" - these are matrixes, not numerics</span></span>
<span><span class="va">sorted_moby_freqs_t</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"he"</span>, <span class="st">"she"</span>, <span class="st">"him"</span>, <span class="st">"her"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   he  she  him  her </span></span>
<span><span class="co">## 1761  116 1051  326</span></span></code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># another method: indexing the dfm</span></span>
<span><span class="va">moby_dfm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"he"</span>, <span class="st">"she"</span>, <span class="st">"him"</span>, <span class="st">"her"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## Document-feature matrix of: 1 document, 4 features (0.00% sparse) and 0 docvars.</span></span>
<span><span class="co">##        features</span></span>
<span><span class="co">## docs      he she  him her</span></span>
<span><span class="co">##   text1 1761 116 1051 326</span></span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sorted_moby_freqs_t</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   the </span></span>
<span><span class="co">## 14451</span></span></code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sorted_moby_freqs_t</span><span class="op">[</span><span class="st">"the"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   the </span></span>
<span><span class="co">## 14451</span></span></code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># term frequency ratios</span></span>
<span><span class="va">sorted_moby_freqs_t</span><span class="op">[</span><span class="st">"him"</span><span class="op">]</span> <span class="op">/</span> <span class="va">sorted_moby_freqs_t</span><span class="op">[</span><span class="st">"her"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##      him </span></span>
<span><span class="co">## 3.223926</span></span></code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sorted_moby_freqs_t</span><span class="op">[</span><span class="st">"he"</span><span class="op">]</span> <span class="op">/</span> <span class="va">sorted_moby_freqs_t</span><span class="op">[</span><span class="st">"she"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##       he </span></span>
<span><span class="co">## 15.18103</span></span></code></pre>
<p>Total number of tokens:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span><span class="op">(</span><span class="va">moby_dfm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  text1 </span></span>
<span><span class="co">## 213374</span></span></code></pre>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sorted_moby_freqs_t</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 213374</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="recycling">3.2 Recycling<a class="anchor" aria-label="anchor" href="#recycling"></a>
</h3>
<p>Relative term frequencies:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sorted_moby_rel_freqs_t</span> <span class="op">&lt;-</span> <span class="va">sorted_moby_freqs_t</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sorted_moby_freqs_t</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="va">sorted_moby_rel_freqs_t</span><span class="op">[</span><span class="st">"the"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##      the </span></span>
<span><span class="co">## 6.772615</span></span></code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># by weighting the dfm directly</span></span>
<span><span class="va">moby_dfm_pct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_weight.html">dfm_weight</a></span><span class="op">(</span><span class="va">moby_dfm</span>, scheme <span class="op">=</span> <span class="st">"prop"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span></span>
<span><span class="fu"><a href="../../../reference/dfm_select.html">dfm_select</a></span><span class="op">(</span><span class="va">moby_dfm_pct</span>, pattern <span class="op">=</span> <span class="st">"the"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Document-feature matrix of: 1 document, 1 feature (0.00% sparse) and 0 docvars.</span></span>
<span><span class="co">##        features</span></span>
<span><span class="co">## docs         the</span></span>
<span><span class="co">##   text1 6.772615</span></span></code></pre>
<p>Plotting the most frequent terms, replicating the plot from the
book:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sorted_moby_rel_freqs_t</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Top Ten Words"</span>, ylab <span class="op">=</span> <span class="st">"Percentage of Full Text"</span>, xaxt <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sorted_moby_rel_freqs_t</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>Plotting the most frequent terms using <strong>ggplot2</strong>:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://quanteda.io/reference/textstat_frequency.html">textstat_frequency</a></span><span class="op">(</span><span class="va">moby_dfm_pct</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">feature</span>, <span class="op">-</span><span class="va">rank</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">frequency</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Term Frequency as a Percentage"</span><span class="op">)</span></span></code></pre></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="token-distribution-analysis">4 Token Distribution Analysis<a class="anchor" aria-label="anchor" href="#token-distribution-analysis"></a>
</h2>
<div class="section level3">
<h3 id="dispersion-plots">4.1 Dispersion plots<a class="anchor" aria-label="anchor" href="#dispersion-plots"></a>
</h3>
<p>A dispersion plot allows us to visualize the occurrences of
particular terms throughout the text. The object returned by the
<code>kwic</code> function can be plotted to display a dispersion plot.
The <strong>quanteda</strong> <code>textplot_</code> objects are based
on <strong>ggplot2</strong>, so you can easily change the plot, for
example by adding custom title.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using words from tokenized corpus for dispersion</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"quanteda.textplots"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/quanteda.textplots/man/textplot_xray.html" class="external-link">textplot_xray</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/kwic.html">kwic</a></span><span class="op">(</span><span class="va">novel_v_toks</span>, pattern <span class="op">=</span> <span class="st">"whale"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Lexical dispersion"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Use of `x$ntokens` is discouraged.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `ntokens` instead.</span></span></code></pre>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-25-1.png" width="768"></p>
<p>To produce multiple dispersion plots for comparison, you can simply
send more than one <code><a href="../../../reference/kwic.html">kwic()</a></code> output to
<code><a href="https://rdrr.io/pkg/quanteda.textplots/man/textplot_xray.html" class="external-link">textplot_xray()</a></code>:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/quanteda.textplots/man/textplot_xray.html" class="external-link">textplot_xray</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../../../reference/kwic.html">kwic</a></span><span class="op">(</span><span class="va">novel_v_toks</span>, pattern <span class="op">=</span> <span class="st">"whale"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../../../reference/kwic.html">kwic</a></span><span class="op">(</span><span class="va">novel_v_toks</span>, pattern <span class="op">=</span> <span class="st">"Ahab"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Lexical dispersion"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Use of `x$ntokens` is discouraged.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `ntokens` instead.</span></span></code></pre>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-26-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="searching-with-regular-expression">4.2 Searching with regular expression<a class="anchor" aria-label="anchor" href="#searching-with-regular-expression"></a>
</h3>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># identify the chapter break locations</span></span>
<span><span class="va">chap_positions_v</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/kwic.html">kwic</a></span><span class="op">(</span><span class="va">novel_v_toks</span>, <span class="fu"><a href="../../../reference/phrase.html">phrase</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CHAPTER \\d"</span><span class="op">)</span><span class="op">)</span>, valuetype <span class="op">=</span> <span class="st">"regex"</span><span class="op">)</span><span class="op">$</span><span class="va">from</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">chap_positions_v</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  1  6 12 18 24 29</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="identifying-chapter-breaks">4.2 Identifying chapter breaks<a class="anchor" aria-label="anchor" href="#identifying-chapter-breaks"></a>
</h3>
<p>Splitting the text into chapters means that we will have a collection
of documents, which makes this a good time to make a <code>corpus</code>
object to hold the texts. Initially, we make a single-document corpus,
and then use the <code><a href="../../../reference/corpus_segment.html">corpus_segment()</a></code> function to split this by
the string which specifies the chapter breaks.</p>
<p>Because of the header information, however, we want to discard the
first part. We can do this by segmenting the text according to the first
chapter, “CHAPTER 1. Loomings.”, which is preceded by 5 newlines.</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chapters_char</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">data_char_mobydick</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../../../reference/corpus_segment.html">char_segment</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"\\n{5}CHAPTER 1\\. Loomings\\.\\n"</span>, </span>
<span>                 valuetype <span class="op">=</span> <span class="st">"regex"</span>, remove_pattern <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">chapters_char</span>, <span class="va">substring</span>, <span class="fl">1</span>, <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                                                                                               Moby Dick.1 </span></span>
<span><span class="co">##  "The Project Gutenberg eBook of Moby Dick; Or, The Whale\n    \nThis ebook is for the use of anyone any" </span></span>
<span><span class="co">##                                                                                               Moby Dick.2 </span></span>
<span><span class="co">## "CHAPTER 1. Loomings.\n\nCall me Ishmael. Some years ago—never mind how long precisely—having\nlittle or"</span></span></code></pre>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remove header segment</span></span>
<span><span class="va">chapters_char</span> <span class="op">&lt;-</span> <span class="va">chapters_char</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">chapters_char</span>, <span class="fl">1</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## CHAPTER 1. Loomings.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call me Ishmael. Some years ago—never mind how long precisely—having</span></span>
<span><span class="co">## little or no money in my purse, and nothing particular to interest me</span></span>
<span><span class="co">## on shore, I thought I would sail about</span></span></code></pre>
<p>Now we can segment the text based on the chapter titles. These titles
are automatically extracted into the <code>pattern</code> document
variables, and the text of each chapter becomes the text of each new
document unit. To tidy this up, we can remove the trailing
<code>\n</code> character, using <code><a href="https://rdrr.io/pkg/stringi/man/stri_trim.html" class="external-link">stri_trim_both()</a></code>, since
the <code>\n</code> is a member of the “whitespace” group.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chapters_corp</span> <span class="op">&lt;-</span> <span class="va">chapters_char</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../../../reference/corpus.html">corpus</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../../../reference/corpus_segment.html">corpus_segment</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"CHAPTER\\s\\d+.*\\n\\n"</span>, valuetype <span class="op">=</span> <span class="st">"regex"</span><span class="op">)</span></span>
<span><span class="va">chapters_corp</span><span class="op">$</span><span class="va">pattern</span> <span class="op">&lt;-</span> <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_trim.html" class="external-link">stri_trim_both</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">$</span><span class="va">pattern</span><span class="op">)</span></span>
<span><span class="va">chapters_corp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/corpus_subset.html">corpus_subset</a></span><span class="op">(</span><span class="va">chapters_corp</span>, <span class="va">chapters_corp</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">chapters_corp</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Corpus consisting of 132 documents, showing 10 documents:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            Text Types Tokens Sentences                     pattern</span></span>
<span><span class="co">##   Moby Dick.2.1   919   2507       101        CHAPTER 1. Loomings.</span></span>
<span><span class="co">##   Moby Dick.2.2   655   1668        60  CHAPTER 2. The Carpet-Bag.</span></span>
<span><span class="co">##   Moby Dick.2.3  1777   6785       263 CHAPTER 3. The Spouter-Inn.</span></span>
<span><span class="co">##   Moby Dick.2.4   686   1878        54 CHAPTER 4. The Counterpane.</span></span>
<span><span class="co">##   Moby Dick.2.5   405    848        29       CHAPTER 5. Breakfast.</span></span>
<span><span class="co">##   Moby Dick.2.6   467    933        44      CHAPTER 6. The Street.</span></span>
<span><span class="co">##   Moby Dick.2.7   519   1072        40      CHAPTER 7. The Chapel.</span></span>
<span><span class="co">##   Moby Dick.2.8   479   1070        29      CHAPTER 8. The Pulpit.</span></span>
<span><span class="co">##   Moby Dick.2.9  1268   4219       166      CHAPTER 9. The Sermon.</span></span>
<span><span class="co">##  Moby Dick.2.10   660   1773        66 CHAPTER 10. A Bosom Friend.</span></span></code></pre>
<p>For better reference, let’s also rename the document labels with
these chapter headings:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../../reference/docnames.html">docnames</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">chapters_corp</span><span class="op">$</span><span class="va">pattern</span></span></code></pre></div>
<div class="section level4">
<h4 id="barplots-of-whale-and-ahab">4.4.5 barplots of whale and ahab<a class="anchor" aria-label="anchor" href="#barplots-of-whale-and-ahab"></a>
</h4>
<p>With the corpus split into chapters, we can use the
<code><a href="../../../reference/dfm.html">dfm()</a></code> function to create a matrix of counts of each word in
each chapter – a document-frequency matrix.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a dfm</span></span>
<span><span class="va">chap_dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/tokens.html">tokens</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../../../reference/dfm.html">dfm</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract row with count for "whale"/"ahab" in each chapter</span></span>
<span><span class="co"># and convert to data frame for plotting</span></span>
<span><span class="va">whales_ahabs_df</span> <span class="op">&lt;-</span> <span class="va">chap_dfm</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="../../../reference/dfm_select.html">dfm_keep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"whale"</span>, <span class="st">"ahab"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="../../../reference/convert.html">convert</a></span><span class="op">(</span>to <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span></span>
<span>    </span>
<span><span class="va">whales_ahabs_df</span><span class="op">$</span><span class="va">chapter</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">whales_ahabs_df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">whales_ahabs_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">chapter</span>, y <span class="op">=</span> <span class="va">whale</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Chapter"</span>, </span>
<span>         y <span class="op">=</span> <span class="st">"Frequency"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">'Occurrence of "whale"'</span><span class="op">)</span></span></code></pre></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-31-1.png" width="768"></p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">whales_ahabs_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">chapter</span>, y <span class="op">=</span> <span class="va">ahab</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Chapter"</span>, </span>
<span>         y <span class="op">=</span> <span class="st">"Frequency"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">'Occurrence of "ahab"'</span><span class="op">)</span></span></code></pre></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-31-2.png" width="768"></p>
<p>The above plots are raw frequency plots. For relative frequency
plots, (word count divided by the length of the chapter) we can weight
the document-frequency matrix. To obtain expected word frequency per 100
words, we multiply by 100. To get a feel for what the resulting weighted
dfm (document-feature matrix) looks like, you can inspect it with the
<code>head</code> function, which prints the first few rows and
columns.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rel_dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_weight.html">dfm_weight</a></span><span class="op">(</span><span class="va">chap_dfm</span>, scheme <span class="op">=</span> <span class="st">"prop"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rel_dfm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Document-feature matrix of: 6 documents, 19,651 features (96.02% sparse) and 1 docvar.</span></span>
<span><span class="co">##                              features</span></span>
<span><span class="co">## docs                                call        me    ishmael        .</span></span>
<span><span class="co">##   CHAPTER 1. Loomings.        0.03988831 0.9573195 0.07977663 3.191065</span></span>
<span><span class="co">##   CHAPTER 2. The Carpet-Bag.  0          0.3597122 0.23980815 2.697842</span></span>
<span><span class="co">##   CHAPTER 3. The Spouter-Inn. 0.01473839 0.6190125 0          3.345615</span></span>
<span><span class="co">##   CHAPTER 4. The Counterpane. 0          1.0117146 0          2.715655</span></span>
<span><span class="co">##   CHAPTER 5. Breakfast.       0          0.1179245 0          3.066038</span></span>
<span><span class="co">##   CHAPTER 6. The Street.      0          0.1071811 0          4.180064</span></span>
<span><span class="co">##                              features</span></span>
<span><span class="co">## docs                                some      years  ago—never       mind</span></span>
<span><span class="co">##   CHAPTER 1. Loomings.        0.43877144 0.03988831 0.03988831 0.03988831</span></span>
<span><span class="co">##   CHAPTER 2. The Carpet-Bag.  0.05995204 0.05995204 0          0.05995204</span></span>
<span><span class="co">##   CHAPTER 3. The Spouter-Inn. 0.25055269 0.05895357 0          0.04421518</span></span>
<span><span class="co">##   CHAPTER 4. The Counterpane. 0.05324814 0          0          0.05324814</span></span>
<span><span class="co">##   CHAPTER 5. Breakfast.       0.23584906 0          0          0         </span></span>
<span><span class="co">##   CHAPTER 6. The Street.      0.10718114 0          0          0         </span></span>
<span><span class="co">##                              features</span></span>
<span><span class="co">## docs                                 how       long</span></span>
<span><span class="co">##   CHAPTER 1. Loomings.        0.11966494 0.07977663</span></span>
<span><span class="co">##   CHAPTER 2. The Carpet-Bag.  0.05995204 0         </span></span>
<span><span class="co">##   CHAPTER 3. The Spouter-Inn. 0.05895357 0.14738394</span></span>
<span><span class="co">##   CHAPTER 4. The Counterpane. 0.21299255 0.10649627</span></span>
<span><span class="co">##   CHAPTER 5. Breakfast.       0.23584906 0.23584906</span></span>
<span><span class="co">##   CHAPTER 6. The Street.      0.21436227 0         </span></span>
<span><span class="co">## [ reached max_nfeat ... 19,641 more features ]</span></span></code></pre>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subset dfm and convert to data.frame object</span></span>
<span><span class="va">rel_chap_freq</span> <span class="op">&lt;-</span> <span class="va">rel_dfm</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="../../../reference/dfm_select.html">dfm_keep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"whale"</span>, <span class="st">"ahab"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="../../../reference/convert.html">convert</a></span><span class="op">(</span>to <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rel_chap_freq</span><span class="op">$</span><span class="va">chapter</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">rel_chap_freq</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rel_chap_freq</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">chapter</span>, y <span class="op">=</span> <span class="va">whale</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Chapter"</span>, y <span class="op">=</span> <span class="st">"Relative frequency"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">'Occurrence of "whale"'</span><span class="op">)</span></span></code></pre></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-32-1.png" width="768"></p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rel_chap_freq</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">chapter</span>, y <span class="op">=</span> <span class="va">ahab</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Chapter"</span>, y <span class="op">=</span> <span class="st">"Relative frequency"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">'Occurrence of "ahab"'</span><span class="op">)</span></span></code></pre></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-32-2.png" width="768"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="correlation">5 Correlation<a class="anchor" aria-label="anchor" href="#correlation"></a>
</h2>
<div class="section level3">
<h3 id="correlation-analysis">5.2 Correlation Analysis<a class="anchor" aria-label="anchor" href="#correlation-analysis"></a>
</h3>
<p>Correlation analysis (and many other similarity measures) can be
constructed using fast, sparse means through the
<code><a href="https://quanteda.io/reference/textstat_simil.html">textstat_simil()</a></code> function. Here, we select feature
comparisons for just “whale” and “ahab”, and convert this into a matrix
as in the book. Because correlations are sensitive to document length,
we first convert this into a relative frequency using
<code><a href="../../../reference/dfm_weight.html">dfm_weight()</a></code>.</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../../reference/dfm_weight.html">dfm_weight</a></span><span class="op">(</span><span class="va">chap_dfm</span>, scheme <span class="op">=</span> <span class="st">"prop"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://quanteda.io/reference/textstat_simil.html">textstat_simil</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">chap_dfm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"whale"</span>, <span class="st">"ahab"</span><span class="op">)</span><span class="op">]</span>, method <span class="op">=</span> <span class="st">"correlation"</span>, margin <span class="op">=</span> <span class="st">"features"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           whale        ahab</span></span>
<span><span class="co">## call  0.1003068 -0.03578342</span></span>
<span><span class="co">## me   -0.1656477  0.07728298</span></span></code></pre>
<p>With the ahab frequency and whale frequency vectors extracted from
the dfm, it is easy to calculate the significance of the
correlation.</p>
</div>
<div class="section level3">
<h3 id="testing-correlation-with-randomization">5.4 Testing Correlation with Randomization<a class="anchor" aria-label="anchor" href="#testing-correlation-with-randomization"></a>
</h3>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cor_data_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_weight.html">dfm_weight</a></span><span class="op">(</span><span class="va">chap_dfm</span>, scheme <span class="op">=</span> <span class="st">"prop"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="../../../reference/dfm_select.html">dfm_keep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ahab"</span>, <span class="st">"whale"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="../../../reference/convert.html">convert</a></span><span class="op">(</span>to <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sample 1000 replicates and create data frame</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    cor_sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">cor_data_df</span><span class="op">$</span><span class="va">whale</span><span class="op">)</span>, <span class="va">cor_data_df</span><span class="op">$</span><span class="va">ahab</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    id_sample <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot distribution of resampled correlations</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">samples</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cor_sample</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span>, binwidth <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Correlation Coefficient"</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>         title <span class="op">=</span> <span class="st">"Histogram of Random Correlation Coefficients with Normal Curve"</span><span class="op">)</span></span></code></pre></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-34-1.png" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="measures-of-lexical-variety">6 Measures of Lexical Variety<a class="anchor" aria-label="anchor" href="#measures-of-lexical-variety"></a>
</h2>
<div class="section level3">
<h3 id="mean-word-frequency">6.2 Mean word frequency<a class="anchor" aria-label="anchor" href="#mean-word-frequency"></a>
</h3>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># length of the book in chapters</span></span>
<span><span class="fu"><a href="../../../reference/ndoc.html">ndoc</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 132</span></span></code></pre>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># chapter names</span></span>
<span><span class="fu"><a href="../../../reference/docnames.html">docnames</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "CHAPTER 1. Loomings."        "CHAPTER 2. The Carpet-Bag." </span></span>
<span><span class="co">## [3] "CHAPTER 3. The Spouter-Inn." "CHAPTER 4. The Counterpane."</span></span>
<span><span class="co">## [5] "CHAPTER 5. Breakfast."       "CHAPTER 6. The Street."</span></span></code></pre>
<p>Calculating the mean word frequencies is easy:</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for first few chapters</span></span>
<span><span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        CHAPTER 1. Loomings.  CHAPTER 2. The Carpet-Bag. </span></span>
<span><span class="co">##                        2507                        1668 </span></span>
<span><span class="co">## CHAPTER 3. The Spouter-Inn. CHAPTER 4. The Counterpane. </span></span>
<span><span class="co">##                        6785                        1878 </span></span>
<span><span class="co">##       CHAPTER 5. Breakfast.      CHAPTER 6. The Street. </span></span>
<span><span class="co">##                         848                         933</span></span></code></pre>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># average</span></span>
<span><span class="op">(</span><span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="../../../reference/ntoken.html">ntype</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        CHAPTER 1. Loomings.  CHAPTER 2. The Carpet-Bag. </span></span>
<span><span class="co">##                    2.727965                    2.546565 </span></span>
<span><span class="co">## CHAPTER 3. The Spouter-Inn. CHAPTER 4. The Counterpane. </span></span>
<span><span class="co">##                    3.818233                    2.737609 </span></span>
<span><span class="co">##       CHAPTER 5. Breakfast.      CHAPTER 6. The Street. </span></span>
<span><span class="co">##                    2.093827                    1.997859</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="extracting-word-usage-means">6.3 Extracting Word Usage Means<a class="anchor" aria-label="anchor" href="#extracting-word-usage-means"></a>
</h3>
<p>Since the quotient of the number of tokens and number of types is a
vector, we can simply feed this to <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> using the pipe
operator:</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="../../../reference/ntoken.html">ntype</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"h"</span>, ylab <span class="op">=</span> <span class="st">"Mean word frequency"</span><span class="op">)</span></span></code></pre></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-37-1.png" width="768"></p>
<p>For the scaled plot:</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="../../../reference/ntoken.html">ntype</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"h"</span>, ylab <span class="op">=</span> <span class="st">"Scaled mean word frequency"</span><span class="op">)</span></span></code></pre></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-38-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="ranking-the-values">6.4 Ranking the values<a class="anchor" aria-label="anchor" href="#ranking-the-values"></a>
</h3>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean_word_use_m</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="../../../reference/ntoken.html">ntype</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">mean_word_use_m</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## CHAPTER 135. The Chase.—Third Day.   CHAPTER 54. The Town-Ho’s Story. </span></span>
<span><span class="co">##                           4.110568                           4.069409 </span></span>
<span><span class="co">##              CHAPTER 16. The Ship.        CHAPTER 3. The Spouter-Inn. </span></span>
<span><span class="co">##                           3.892216                           3.818233 </span></span>
<span><span class="co">##              CHAPTER 32. Cetology.       CHAPTER 72. The Monkey-Rope. </span></span>
<span><span class="co">##                           3.662275                           3.585056</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="calculating-the-ttr">6.5 Calculating the TTR<a class="anchor" aria-label="anchor" href="#calculating-the-ttr"></a>
</h3>
<p>Measures of lexical diversity can be estimated using
<code><a href="https://quanteda.io/reference/textstat_lexdiv.html">textstat_lexdiv()</a></code>. The TTR (Type-Token Ratio), a measure
used in section 6.5, can be calculated for each document of the
<code>dfm</code>.</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../../reference/tokens.html">tokens</a></span><span class="op">(</span><span class="va">chapters_corp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../../../reference/dfm.html">dfm</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://quanteda.io/reference/textstat_lexdiv.html">textstat_lexdiv</a></span><span class="op">(</span>measure <span class="op">=</span> <span class="st">"TTR"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                       document       TTR</span></span>
<span><span class="co">## 1         CHAPTER 1. Loomings. 0.3893443</span></span>
<span><span class="co">## 2   CHAPTER 2. The Carpet-Bag. 0.4330764</span></span>
<span><span class="co">## 3  CHAPTER 3. The Spouter-Inn. 0.2900000</span></span>
<span><span class="co">## 4  CHAPTER 4. The Counterpane. 0.4014599</span></span>
<span><span class="co">## 5        CHAPTER 5. Breakfast. 0.5190736</span></span>
<span><span class="co">## 6       CHAPTER 6. The Street. 0.5396040</span></span>
<span><span class="co">## 7       CHAPTER 7. The Chapel. 0.5122732</span></span>
<span><span class="co">## 8       CHAPTER 8. The Pulpit. 0.4862288</span></span>
<span><span class="co">## 9       CHAPTER 9. The Sermon. 0.3350154</span></span>
<span><span class="co">## 10 CHAPTER 10. A Bosom Friend. 0.4018088</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="hapax-richness">7 Hapax Richness<a class="anchor" aria-label="anchor" href="#hapax-richness"></a>
</h2>
<p>Another measure of lexical diversity is Hapax richness, defined as
the number of words that occur only once divided by the total number of
words. We can calculate Hapax richness very simply by using a logical
operation on the document-feature matrix, to return a logical value for
each term that occurs once, and then sum these to get a count.</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># hapaxes per document</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">chap_dfm</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        CHAPTER 1. Loomings.  CHAPTER 2. The Carpet-Bag. </span></span>
<span><span class="co">##                         624                         443 </span></span>
<span><span class="co">## CHAPTER 3. The Spouter-Inn. CHAPTER 4. The Counterpane. </span></span>
<span><span class="co">##                        1140                         472 </span></span>
<span><span class="co">##       CHAPTER 5. Breakfast.      CHAPTER 6. The Street. </span></span>
<span><span class="co">##                         283                         346</span></span></code></pre>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># as a proportion</span></span>
<span><span class="va">hapax_proportion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">chap_dfm</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="../../../reference/ntoken.html">ntoken</a></span><span class="op">(</span><span class="va">chap_dfm</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hapax_proportion</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        CHAPTER 1. Loomings.  CHAPTER 2. The Carpet-Bag. </span></span>
<span><span class="co">##                   0.2489031                   0.2655875 </span></span>
<span><span class="co">## CHAPTER 3. The Spouter-Inn. CHAPTER 4. The Counterpane. </span></span>
<span><span class="co">##                   0.1680177                   0.2513312 </span></span>
<span><span class="co">##       CHAPTER 5. Breakfast.      CHAPTER 6. The Street. </span></span>
<span><span class="co">##                   0.3337264                   0.3708467</span></span></code></pre>
<p>To plot this:</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">hapax_proportion</span>, beside <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"grey"</span>, names.arg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/ndoc.html">ndoc</a></span><span class="op">(</span><span class="va">chap_dfm</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-42-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="do-it-kwic">8 Do it KWIC<a class="anchor" aria-label="anchor" href="#do-it-kwic"></a>
</h2>
<p>For this, and the next chapter, we simply use
<strong>quanteda</strong>’s excellent <code><a href="../../../reference/kwic.html">kwic()</a></code> function. To
find the indexes of the token positions for “gutenberg”, for instance,
we use the following, which returns a data.frame with the name
<code>from</code> indicating the index position of the start of the
token match:</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_tokens_mobydick</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/tokens.html">tokens</a></span><span class="op">(</span><span class="va">data_char_mobydick</span><span class="op">)</span></span>
<span><span class="va">gutenberg_kwic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/kwic.html">kwic</a></span><span class="op">(</span><span class="va">data_tokens_mobydick</span>, pattern <span class="op">=</span> <span class="st">"gutenberg"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gutenberg_kwic</span><span class="op">$</span><span class="va">from</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1]      3     60    142 252781 252879 252887 252894 252930 252977 253024</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="do-it-kwic-better">9 Do it KWIC (Better)<a class="anchor" aria-label="anchor" href="#do-it-kwic-better"></a>
</h2>
<p>This is going to be super easy since we don’t need to reinvent the
wheel here, since <code><a href="../../../reference/kwic.html">kwic()</a></code> already does all that we need.</p>
<p>Let’s create a corpus containing <em>Moby Dick</em> but also Jane
Austen’s <em>Sense and Sensibility</em>.</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_char_senseandsensibility</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu">readtext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/readtext/man/readtext.html" class="external-link">readtext</a></span><span class="op">(</span><span class="st">"http://www.gutenberg.org/files/161/161-0.txt"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_char_senseandsensibility</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Sense and Sensibility"</span></span>
<span></span>
<span><span class="va">litcorpus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/corpus.html">corpus</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data_char_mobydick</span>, <span class="va">data_char_senseandsensibility</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we can use <code><a href="../../../reference/kwic.html">kwic()</a></code> to find out where in each novel
this occurred:</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">dogkwic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/kwic.html">kwic</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/tokens.html">tokens</a></span><span class="op">(</span><span class="va">litcorpus</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"dog"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Keyword-in-context with 17 matches.                                                                       </span></span>
<span><span class="co">##              [Moby Dick, 17804]    all over like a Newfoundland | dog |</span></span>
<span><span class="co">##              [Moby Dick, 32180]        was seen swimming like a | dog |</span></span>
<span><span class="co">##              [Moby Dick, 59875]                   last. — Down, | dog |</span></span>
<span><span class="co">##              [Moby Dick, 59976]          not tamely be called a | dog |</span></span>
<span><span class="co">##              [Moby Dick, 60485]             didn’t he call me a | dog |</span></span>
<span><span class="co">##              [Moby Dick, 86548]   sacrifice of the sacred White | Dog |</span></span>
<span><span class="co">##             [Moby Dick, 124868]            life that lives in a | dog |</span></span>
<span><span class="co">##             [Moby Dick, 124964]   the sagacious kindness of the | dog |</span></span>
<span><span class="co">##             [Moby Dick, 158387] “ The ungracious and ungrateful | dog |</span></span>
<span><span class="co">##             [Moby Dick, 158427]           Give way, greyhounds! | Dog |</span></span>
<span><span class="co">##             [Moby Dick, 169591]             to the whale that a | dog |</span></span>
<span><span class="co">##             [Moby Dick, 192660]     Aries, or the Ram—lecherous | dog |</span></span>
<span><span class="co">##             [Moby Dick, 196112]                 . ( Bunger, you | dog |</span></span>
<span><span class="co">##             [Moby Dick, 196573]              die in pickle, you | dog |</span></span>
<span><span class="co">##             [Moby Dick, 197193]                Ahab, and like a | dog |</span></span>
<span><span class="co">##             [Moby Dick, 238784]       air as a sagacious ship’s | dog |</span></span>
<span><span class="co">##  [Sense and Sensibility, 77779]        fellow! such a deceitful | dog |</span></span>
<span><span class="co">##                            </span></span>
<span><span class="co">##  just from the water,      </span></span>
<span><span class="co">##  , throwing his long arms  </span></span>
<span><span class="co">##  , and kennel! ”           </span></span>
<span><span class="co">##  , sir. ” “                </span></span>
<span><span class="co">##  ? blazes! he called       </span></span>
<span><span class="co">##  was by far the holiest    </span></span>
<span><span class="co">##  or a horse. Indeed        </span></span>
<span><span class="co">##  ? The accursed shark alone</span></span>
<span><span class="co">##  ! ” cried Starbuck;       </span></span>
<span><span class="co">##  to it! ” “                </span></span>
<span><span class="co">##  does to the elephant;     </span></span>
<span><span class="co">##  , he begets us;           </span></span>
<span><span class="co">##  , laugh out! why          </span></span>
<span><span class="co">##  ; you should be preserved </span></span>
<span><span class="co">##  , strangely snuffing; “   </span></span>
<span><span class="co">##  will, in drawing nigh     </span></span>
<span><span class="co">##  ! It was only the</span></span></code></pre>
<p>We can plot this easily too, as a lexical dispersion plot. By
specifying the scale as “absolute”, we are looking at absolute token
index position rather than relative position, and therefore we see that
<em>Moby Dick</em> is nearly twice as long as <em>Sense and
Sensibility</em>.</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/quanteda.textplots/man/textplot_xray.html" class="external-link">textplot_xray</a></span><span class="op">(</span><span class="va">dogkwic</span>, scale <span class="op">=</span> <span class="st">"absolute"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Use of `x$ntokens` is discouraged.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `ntokens` instead.</span></span></code></pre>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-47-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="text-quality-text-variety-and-parsing-xml">10 Text Quality, Text Variety, and Parsing XML<a class="anchor" aria-label="anchor" href="#text-quality-text-variety-and-parsing-xml"></a>
</h2>
</div>
<div class="section level2">
<h2 id="clustering">11 Clustering<a class="anchor" aria-label="anchor" href="#clustering"></a>
</h2>
<p>Chapter 11 describes how to detect clusters in a corpus. While the
book uses the <code>XMLAuthorCorpus</code>, we describe clustering using
U.S. State of the Union addresses included in the
<strong>quanteda.corpora</strong> package. We trim the corpus with
<code><a href="../../../reference/dfm_trim.html">dfm_trim()</a></code> by keeping only those words that occur at least
five times in the corpus and in at least three speeches.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/quanteda/quanteda.corpora" class="external-link">quanteda.corpora</a></span><span class="op">)</span></span>
<span><span class="va">pres_dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/tokens.html">tokens</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/corpus_subset.html">corpus_subset</a></span><span class="op">(</span><span class="va">data_corpus_sotu</span>, <span class="va">Date</span> <span class="op">&gt;</span> <span class="st">"1980-01-01"</span><span class="op">)</span>, remove_punct <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/tokens_wordstem.html">tokens_wordstem</a></span><span class="op">(</span><span class="st">"en"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/tokens_select.html">tokens_remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/stopwords/man/stopwords.html" class="external-link">stopwords</a></span><span class="op">(</span><span class="st">"en"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/dfm.html">dfm</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/dfm_trim.html">dfm_trim</a></span><span class="op">(</span>min_termfreq <span class="op">=</span> <span class="fl">5</span>, min_docfreq <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># hierarchical clustering - get distances on normalized dfm</span></span>
<span><span class="va">pres_dist_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_weight.html">dfm_weight</a></span><span class="op">(</span><span class="va">pres_dfm</span>, scheme <span class="op">=</span> <span class="st">"prop"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://quanteda.io/reference/textstat_simil.html">textstat_dist</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># hiarchical clustering the distance object</span></span>
<span><span class="va">pres_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">pres_dist_mat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># label with document names</span></span>
<span><span class="va">pres_cluster</span><span class="op">$</span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/docnames.html">docnames</a></span><span class="op">(</span><span class="va">pres_dfm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot as a dendrogram</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pres_cluster</span>, xlab <span class="op">=</span> <span class="st">""</span>, sub <span class="op">=</span> <span class="st">""</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Euclidean Distance on Normalized Token Frequency"</span><span class="op">)</span></span></code></pre></div>
<p><img src="digital-humanities_files/figure-html/unnamed-chunk-48-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="classification">12 Classification<a class="anchor" aria-label="anchor" href="#classification"></a>
</h2>
</div>
<div class="section level2">
<h2 id="topic-modelling">13 Topic Modelling<a class="anchor" aria-label="anchor" href="#topic-modelling"></a>
</h2>
<p>Finally, Jockers’ book introduces topic modelling of a corpus and the
visualisation through wordclouds. We can easily apply functions from the
<strong>topicmodels</strong> package by using
<strong>quanteda</strong>’s <code><a href="../../../reference/convert.html">convert()</a></code> function. In our
example, we use the Irish budget speeches from 2010
(<code>data_corpus_irishbudget2010</code>) and classify 20 topics using
Latent Dirichlet Allocation.</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data_corpus_irishbudget2010</span>, package <span class="op">=</span> <span class="st">"quanteda.textmodels"</span><span class="op">)</span></span>
<span><span class="va">dfm_speeches</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/tokens.html">tokens</a></span><span class="op">(</span><span class="va">data_corpus_irishbudget2010</span>, remove_punct <span class="op">=</span> <span class="cn">TRUE</span>, remove_numbers <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/tokens_select.html">tokens_remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/stopwords/man/stopwords.html" class="external-link">stopwords</a></span><span class="op">(</span><span class="st">"en"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../../../reference/dfm.html">dfm</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/dfm_trim.html">dfm_trim</a></span><span class="op">(</span>min_termfreq <span class="op">=</span> <span class="fl">4</span>, max_docfreq <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">topicmodels</span><span class="op">)</span></span>
<span><span class="va">LDA_fit_20</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/convert.html">convert</a></span><span class="op">(</span><span class="va">dfm_speeches</span>, to <span class="op">=</span> <span class="st">"topicmodels"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/topicmodels/man/lda.html" class="external-link">LDA</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get top five terms per topic</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/topicmodels/man/get.html" class="external-link">get_terms</a></span><span class="op">(</span><span class="va">LDA_fit_20</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Topic 1  Topic 2       Topic 3   Topic 4     Topic 5     Topic 6    </span></span>
<span><span class="co">## [1,] "fáil"   "fianna"      "levy"    "care"      "taoiseach" "may"      </span></span>
<span><span class="co">## [2,] "fianna" "fáil"        "million" "welfare"   "employees" "taoiseach"</span></span>
<span><span class="co">## [3,] "better" "citizenship" "carbon"  "per"       "rate"      "gael"     </span></span>
<span><span class="co">## [4,] "system" "side"        "change"  "allowance" "referred"  "fine"     </span></span>
<span><span class="co">## [5,] "féin"   "alternative" "welfare" "hit"       "debate"    "local"    </span></span>
<span><span class="co">##      Topic 7   Topic 8     Topic 9   Topic 10      Topic 11     Topic 12      </span></span>
<span><span class="co">## [1,] "benefit" "spending"  "child"   "kind"        "measures"   "society"     </span></span>
<span><span class="co">## [2,] "day"     "scheme"    "irish"   "imagination" "million"    "enterprising"</span></span>
<span><span class="co">## [3,] "child"   "reduction" "banks"   "policies"    "reduced"    "sense"       </span></span>
<span><span class="co">## [4,] "bank"    "measures"  "poverty" "wit"         "investment" "equal"       </span></span>
<span><span class="co">## [5,] "society" "prices"    "single"  "create"      "spending"   "nation"      </span></span>
<span><span class="co">##      Topic 13     Topic 14     Topic 15     Topic 16  Topic 17    Topic 18  </span></span>
<span><span class="co">## [1,] "phase"      "million"    "confidence" "welfare" "taoiseach" "fianna"  </span></span>
<span><span class="co">## [2,] "reductions" "support"    "ensure"     "million" "problems"  "fáil"    </span></span>
<span><span class="co">## [3,] "support"    "welfare"    "needs"      "pension" "stimulus"  "national"</span></span>
<span><span class="co">## [4,] "spending"   "investment" "adjustment" "local"   "fine"      "irish"   </span></span>
<span><span class="co">## [5,] "welfare"    "back"       "property"   "details" "training"  "support" </span></span>
<span><span class="co">##      Topic 19    Topic 20      </span></span>
<span><span class="co">## [1,] "failed"    "welfare"     </span></span>
<span><span class="co">## [2,] "strategy"  "system"      </span></span>
<span><span class="co">## [3,] "needed"    "taxation"    </span></span>
<span><span class="co">## [4,] "ministers" "stimulus"    </span></span>
<span><span class="co">## [5,] "system"    "government's"</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kenneth Benoit, Kohei Watanabe, Haiyan Wang, Paul Nulty, Adam Obeng, Stefan Müller, Akitaka Matsuo, William Lowe, European Research Council.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({


    apiKey: '9b4ef7fd791dc6075154d3ebd7b12acf',
    indexName: 'quanteda',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
