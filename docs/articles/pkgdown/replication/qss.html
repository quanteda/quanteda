<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Replication of Chapter 5 of _Quantitative Social Science: An Introduction_ • quanteda</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../../bootstrap-toc.css">
<script src="../../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../../pkgdown.css" rel="stylesheet">
<script src="../../../pkgdown.js"></script><!-- docsearch --><script src="../../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../../../extra.css" rel="stylesheet">
<script src="../../../extra.js"></script><meta property="og:title" content="Replication of Chapter 5 of _Quantitative Social Science: An Introduction_">
<meta property="og:description" content="quanteda">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-0F398Z98L1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0F398Z98L1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../../index.html">quanteda</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Quick Start
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/quickstart.html">Quick Start Guide</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_es.html">Guía de Inicio Rápido</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_cn.html">快速入门指南</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_ja.html">クイック・スタートガイド</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/quickstart_hi.html">त्वरित आरंभ </a>
    </li>
  </ul>
</li>
<li>
  <a href="../../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Features
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/tokens_xptr.html">External pointer tokens objects</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/benchmarks_xptr.html">Performance benchmarks for v4</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/design.html">Package design</a>
    </li>
    <li>
      <a href="../../../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/examples/phrase.html">Multi-word expressions</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/plotting.html">Textual data visualization</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/lsa.html">Latent Semantic Analysis (LSA)</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/chinese.html">Chinese text analysis</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/examples/twitter.html">Social media analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Replications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../../articles/pkgdown/replication/digital-humanities.html">Text Analysis with R for Students of Literature</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/replication/text2vec.html">Word embedding (word2vec)</a>
    </li>
    <li>
      <a href="../../../articles/pkgdown/replication/qss.html">Quantitative Social Science Ch. 5.1</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/quanteda/quanteda" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Replication of Chapter 5 of <em>Quantitative
Social Science: An Introduction</em>
</h1>
                        <h4 data-toc-skip class="author">Stefan Müller
and Kenneth Benoit</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/quanteda/quanteda/blob/HEAD/vignettes/pkgdown/replication/qss.Rmd" class="external-link"><code>vignettes/pkgdown/replication/qss.Rmd</code></a></small>
      <div class="hidden name"><code>qss.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://quanteda.io">"quanteda"</a></span><span class="op">)</span></span></code></pre></div>
<p>In this vignette we show how the <strong>quanteda</strong> package
can be used to replicate the text analysis part (Chapter 5.1) from
Kosuke Imai’s book <a href="http://qss.princeton.press" class="external-link"><em>Quantitative
Social Science: An Introduction</em></a> (Princeton: Princeton
University Press, 2017).</p>
<div class="section level2">
<h2 id="download-the-corpus">Download the Corpus<a class="anchor" aria-label="anchor" href="#download-the-corpus"></a>
</h2>
<p>To get the textual data, you need to install and load the
<strong>qss</strong> package first that comes with the book.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"kosukeimai/qss-package"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="section-5-1-1-the-disputed-authorship-of-the-federalist-papers">Section 5.1.1: The Disputed Authorship of ‘The Federalist
Papers’<a class="anchor" aria-label="anchor" href="#section-5-1-1-the-disputed-authorship-of-the-federalist-papers"></a>
</h2>
<p>First, we use the <strong>readtext</strong> package to import the
Federalist Papers as a data frame and create a <strong>quanteda</strong>
corpus.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use readtext package to import all documents as a dataframe</span></span>
<span><span class="va">corpus_texts</span> <span class="op">&lt;-</span> <span class="fu">readtext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/readtext/man/readtext.html" class="external-link">readtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/federalist/"</span>, package <span class="op">=</span> <span class="st">"qss"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create docvar with number of paper</span></span>
<span><span class="va">corpus_texts</span><span class="op">$</span><span class="va">paper_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"No."</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">corpus_texts</span><span class="op">)</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># transform to a quanteda corpus object</span></span>
<span><span class="va">corpus_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/corpus.html">corpus</a></span><span class="op">(</span><span class="va">corpus_texts</span>, text_field <span class="op">=</span> <span class="st">"text"</span>, docid_field <span class="op">=</span> <span class="st">"paper_number"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create docvar with authorship (used in Section  5.1.4)</span></span>
<span><span class="fu"><a href="../../../reference/docvars.html">docvars</a></span><span class="op">(</span><span class="va">corpus_raw</span>, <span class="st">"paper_numeric"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/ndoc.html">ndoc</a></span><span class="op">(</span><span class="va">corpus_raw</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create docvar with authorship (used in Section  5.1.4)</span></span>
<span><span class="fu"><a href="../../../reference/docvars.html">docvars</a></span><span class="op">(</span><span class="va">corpus_raw</span>, <span class="st">"author"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"madison"</span>, <span class="st">"hamilton"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../../../reference/docvars.html">docvars</a></span><span class="op">(</span><span class="va">corpus_raw</span>, <span class="st">"author"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">9</span>, <span class="fl">11</span><span class="op">:</span><span class="fl">13</span>, <span class="fl">15</span><span class="op">:</span><span class="fl">17</span>, <span class="fl">21</span><span class="op">:</span><span class="fl">36</span>, <span class="fl">59</span><span class="op">:</span><span class="fl">61</span>, <span class="fl">65</span><span class="op">:</span><span class="fl">85</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"hamilton"</span></span>
<span><span class="fu"><a href="../../../reference/docvars.html">docvars</a></span><span class="op">(</span><span class="va">corpus_raw</span>, <span class="st">"author"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">14</span>, <span class="fl">37</span><span class="op">:</span><span class="fl">48</span>, <span class="fl">58</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"madison"</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># inspect Paper No. 10 (output suppressed)</span></span>
<span><span class="va">corpus_raw</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html" class="external-link">stri_sub</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">240</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AMONG the numerous advantages promised by a well-constructed Union, none </span></span>
<span><span class="co">##         deserves to be more accurately developed than its tendency to break and </span></span>
<span><span class="co">##         control the violence of faction. The friend of popular governments never </span></span>
<span><span class="co">## </span></span></code></pre>
</div>
<div class="section level2">
<h2 id="section-5-1-2-document-term-matrix">Section 5.1.2: Document-Term Matrix<a class="anchor" aria-label="anchor" href="#section-5-1-2-document-term-matrix"></a>
</h2>
<p>Next, we transform the corpus to a document-feature matrix.
<code>dfm_prep</code> (used in sections 5.1.4 and 5.1.5) is a dfm in
which numbers and punctuation have been removed, and in which terms have
been converted to lowercase. In <code>dfm_papers</code>, the words have
also been stemmed and a standard set of stopwords removed.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># transform corpus to a document-feature matrix</span></span>
<span><span class="va">dfm_prep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/tokens.html">tokens</a></span><span class="op">(</span><span class="va">corpus_raw</span>, remove_numbers <span class="op">=</span> <span class="cn">TRUE</span>, remove_punct <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/dfm.html">dfm</a></span><span class="op">(</span>tolower <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove stop words and stem words</span></span>
<span><span class="va">dfm_papers</span> <span class="op">&lt;-</span> <span class="va">dfm_prep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/dfm_select.html">dfm_remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/stopwords/man/stopwords.html" class="external-link">stopwords</a></span><span class="op">(</span><span class="st">"en"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/tokens_wordstem.html">dfm_wordstem</a></span><span class="op">(</span><span class="st">"en"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># inspect</span></span>
<span><span class="va">dfm_papers</span></span></code></pre></div>
<pre><code><span><span class="co">## Document-feature matrix of: 85 documents, 4,860 features (89.11% sparse) and 3 docvars.</span></span>
<span><span class="co">##        features</span></span>
<span><span class="co">## docs    unequivoc experi ineffici subsist feder govern call upon deliber new</span></span>
<span><span class="co">##   No. 1         1      1        1       1     1      9    1    6       3   5</span></span>
<span><span class="co">##   No. 2         0      3        0       0     2      9    1    1       1   2</span></span>
<span><span class="co">##   No. 3         0      1        0       0     2     20    0    0       0   1</span></span>
<span><span class="co">##   No. 4         0      2        0       0     0     21    1    0       0   0</span></span>
<span><span class="co">##   No. 5         0      1        0       0     0      3    0    0       0   0</span></span>
<span><span class="co">##   No. 6         0      3        0       0     0      4    0    4       0   1</span></span>
<span><span class="co">## [ reached max_ndoc ... 79 more documents, reached max_nfeat ... 4,850 more features ]</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sort into alphabetical order of features, to match book example</span></span>
<span><span class="va">dfm_papers</span> <span class="op">&lt;-</span> <span class="va">dfm_papers</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/featnames.html">featnames</a></span><span class="op">(</span><span class="va">dfm_papers</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># inspect some documents in the dfm</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dfm_papers</span>, nf <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: nf argument is not used.</span></span></code></pre>
<pre><code><span><span class="co">## Document-feature matrix of: 6 documents, 4,860 features (90.51% sparse) and 3 docvars.</span></span>
<span><span class="co">##        features</span></span>
<span><span class="co">## docs    ` 1st 2d 3d 4th 5th abandon abat abb abet</span></span>
<span><span class="co">##   No. 1 0   0  0  0   0   0       0    0   0    0</span></span>
<span><span class="co">##   No. 2 0   0  0  0   0   0       0    0   0    0</span></span>
<span><span class="co">##   No. 3 0   0  0  0   0   0       0    0   0    0</span></span>
<span><span class="co">##   No. 4 0   0  0  0   0   0       0    0   0    0</span></span>
<span><span class="co">##   No. 5 0   1  0  0   0   0       0    0   0    0</span></span>
<span><span class="co">##   No. 6 0   0  0  0   0   0       0    0   0    0</span></span>
<span><span class="co">## [ reached max_nfeat ... 4,850 more features ]</span></span></code></pre>
<p>The <strong>tm</strong> package considers features such as “1st” to
be numbers, whereas <strong>quanteda</strong> does not. We can remove
these easily using a wildcard removal:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfm_papers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_select.html">dfm_remove</a></span><span class="op">(</span><span class="va">dfm_papers</span>, <span class="st">"[0-9]"</span>, valuetype <span class="op">=</span> <span class="st">"regex"</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## removed 5 features</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dfm_papers</span>, nf <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: nf argument is not used.</span></span></code></pre>
<pre><code><span><span class="co">## Document-feature matrix of: 6 documents, 4,855 features (90.50% sparse) and 3 docvars.</span></span>
<span><span class="co">##        features</span></span>
<span><span class="co">## docs    ` abandon abat abb abet abhorr abil abject abl ablest</span></span>
<span><span class="co">##   No. 1 0       0    0   0    0      0    0      0   1      0</span></span>
<span><span class="co">##   No. 2 0       0    0   0    0      0    1      0   0      0</span></span>
<span><span class="co">##   No. 3 0       0    0   0    0      0    0      0   2      0</span></span>
<span><span class="co">##   No. 4 0       0    0   0    0      0    0      0   1      1</span></span>
<span><span class="co">##   No. 5 0       0    0   0    0      0    0      0   0      0</span></span>
<span><span class="co">##   No. 6 0       0    0   0    0      0    0      0   0      0</span></span>
<span><span class="co">## [ reached max_nfeat ... 4,845 more features ]</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="section-5-1-3-topic-discovery">Section 5.1.3: Topic Discovery<a class="anchor" aria-label="anchor" href="#section-5-1-3-topic-discovery"></a>
</h2>
<p>We can use the <code><a href="https://rdrr.io/pkg/quanteda.textplots/man/textplot_wordcloud.html" class="external-link">textplot_wordcloud()</a></code> function to plot
word clouds of the most frequent words in Papers 12 and 24.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"quanteda.textplots"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/quanteda.textplots/man/textplot_wordcloud.html" class="external-link">textplot_wordcloud</a></span><span class="op">(</span><span class="va">dfm_papers</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"No. 12"</span>, <span class="st">"No. 24"</span><span class="op">)</span>, <span class="op">]</span>, </span>
<span>                   max.words <span class="op">=</span> <span class="fl">50</span>, comparison <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="qss_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
<p>Since <strong>quanteda</strong> cannot do stem completion, we will
skip that part.</p>
<p>Next, we identify clusters of similar essay based on term
frequency-inverse document frequency (<em>tf-idf</em>) and apply the
<span class="math inline">\(k\)</span>-means algorithm to the weighted
dfm.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tf-idf calculation</span></span>
<span><span class="va">dfm_papers_tfidf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_tfidf.html">dfm_tfidf</a></span><span class="op">(</span><span class="va">dfm_papers</span>, base <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 10 most important words for Paper No. 12</span></span>
<span><span class="fu"><a href="../../../reference/topfeatures.html">topfeatures</a></span><span class="op">(</span><span class="va">dfm_papers_tfidf</span><span class="op">[</span><span class="fl">12</span>, <span class="op">]</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     revenu contraband     patrol      excis      coast      trade        per </span></span>
<span><span class="co">##   19.42088   19.22817   19.22817   19.12214   16.22817   15.01500   14.47329 </span></span>
<span><span class="co">##        tax       cent     gallon </span></span>
<span><span class="co">##   13.20080   12.81878   12.81878</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 10 most important words for Paper No. 24</span></span>
<span><span class="fu"><a href="../../../reference/topfeatures.html">topfeatures</a></span><span class="op">(</span><span class="va">dfm_papers_tfidf</span><span class="op">[</span><span class="fl">24</span>, <span class="op">]</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   garrison  dock-yard settlement      spain       armi   frontier    arsenal </span></span>
<span><span class="co">##  24.524777  19.228173  16.228173  13.637564  12.770999  12.262389  10.818782 </span></span>
<span><span class="co">##    western       post     nearer </span></span>
<span><span class="co">##  10.806108  10.228173   9.648857</span></span></code></pre>
<p>We can match the clustering as follows:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">4</span>  <span class="co"># number of clusters</span></span>
<span></span>
<span><span class="co"># subset The Federalist papers written by Hamilton</span></span>
<span></span>
<span><span class="va">dfm_papers_tfidf_hamilton</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_subset.html">dfm_subset</a></span><span class="op">(</span><span class="va">dfm_papers_tfidf</span>, <span class="va">author</span> <span class="op">==</span> <span class="st">"hamilton"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run k-means</span></span>
<span><span class="va">km_out</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></span><span class="op">(</span><span class="va">dfm_papers_tfidf_hamilton</span>, centers <span class="op">=</span> <span class="va">k</span><span class="op">)</span></span>
<span></span>
<span><span class="va">km_out</span><span class="op">$</span><span class="va">iter</span> <span class="co"># check the convergence; number of iterations may vary</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">km_out</span><span class="op">$</span><span class="va">centers</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/featnames.html">featnames</a></span><span class="op">(</span><span class="va">dfm_papers_tfidf_hamilton</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span> <span class="co"># loop for each cluster</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"CLUSTER"</span>, <span class="va">i</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Top 10 words:\n"</span><span class="op">)</span> <span class="co"># 10 most important terms at the centroid</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">km_out</span><span class="op">$</span><span class="va">centers</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Federalist Papers classified: \n"</span><span class="op">)</span> <span class="co"># extract essays classified</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/docnames.html">docnames</a></span><span class="op">(</span><span class="va">dfm_papers_tfidf_hamilton</span><span class="op">)</span><span class="op">[</span><span class="va">km_out</span><span class="op">$</span><span class="va">cluster</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## CLUSTER 1 </span></span>
<span><span class="co">## Top 10 words:</span></span>
<span><span class="co">##     armi  militia   revenu militari      war    trade    taxat     upon </span></span>
<span><span class="co">## 6.271473 5.204072 4.634529 4.413837 4.349851 4.222969 4.065847 4.049374 </span></span>
<span><span class="co">##     land      tax </span></span>
<span><span class="co">## 4.007387 3.889522 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Federalist Papers classified: </span></span>
<span><span class="co">##  [1] "No. 6"  "No. 7"  "No. 8"  "No. 11" "No. 12" "No. 15" "No. 21" "No. 22"</span></span>
<span><span class="co">##  [9] "No. 24" "No. 25" "No. 26" "No. 29" "No. 30" "No. 34" "No. 35" "No. 36"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## CLUSTER 2 </span></span>
<span><span class="co">## Top 10 words:</span></span>
<span><span class="co">##       juri      trial      court     crimin  admiralti     equiti   chanceri </span></span>
<span><span class="co">##  218.20102   84.74567   62.47940   42.06871   40.87463   38.24428   37.86574 </span></span>
<span><span class="co">## common-law     probat      civil </span></span>
<span><span class="co">##   27.04695   27.04695   26.77843 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Federalist Papers classified: </span></span>
<span><span class="co">## [1] "No. 83"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## CLUSTER 3 </span></span>
<span><span class="co">## Top 10 words:</span></span>
<span><span class="co">##     court     appel jurisdict    suprem      juri    tribun    cogniz  inferior </span></span>
<span><span class="co">##  69.68857  35.27513  25.46591  24.79126  22.16104  21.27125  19.12214  18.76875 </span></span>
<span><span class="co">##    appeal re-examin </span></span>
<span><span class="co">##  16.21098  13.52348 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Federalist Papers classified: </span></span>
<span><span class="co">## [1] "No. 81" "No. 82"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## CLUSTER 4 </span></span>
<span><span class="co">## Top 10 words:</span></span>
<span><span class="co">##    senat   presid    claus     upon    court governor    offic  appoint </span></span>
<span><span class="co">## 5.459987 4.228173 3.530536 3.456783 3.254136 3.134332 3.071945 2.823580 </span></span>
<span><span class="co">##  impeach    nomin </span></span>
<span><span class="co">## 2.737110 2.658907 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Federalist Papers classified: </span></span>
<span><span class="co">##  [1] "No. 1"  "No. 9"  "No. 13" "No. 16" "No. 17" "No. 23" "No. 27" "No. 28"</span></span>
<span><span class="co">##  [9] "No. 31" "No. 32" "No. 33" "No. 59" "No. 60" "No. 61" "No. 65" "No. 66"</span></span>
<span><span class="co">## [17] "No. 67" "No. 68" "No. 69" "No. 70" "No. 71" "No. 72" "No. 73" "No. 74"</span></span>
<span><span class="co">## [25] "No. 75" "No. 76" "No. 77" "No. 78" "No. 79" "No. 80" "No. 84" "No. 85"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="section-5-1-4-authorship-prediction">Section 5.1.4: Authorship Prediction<a class="anchor" aria-label="anchor" href="#section-5-1-4-authorship-prediction"></a>
</h2>
<p>In a next step, we want to predict authorship for the Federalist
Papers whose authorship is unknown. As the topics of the Papers differs
remarkably, Imai focuses on 10 articles, prepositions and conjunctions
to predict authorship.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># term frequency per 1000 words</span></span>
<span><span class="va">tfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_weight.html">dfm_weight</a></span><span class="op">(</span><span class="va">dfm_prep</span>, <span class="st">"prop"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># select words of interest</span></span>
<span><span class="va">words</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"although"</span>, <span class="st">"always"</span>, <span class="st">"commonly"</span>, <span class="st">"consequently"</span>,</span>
<span>           <span class="st">"considerable"</span>, <span class="st">"enough"</span>, <span class="st">"there"</span>, <span class="st">"upon"</span>, <span class="st">"while"</span>, <span class="st">"whilst"</span><span class="op">)</span></span>
<span><span class="va">tfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_select.html">dfm_select</a></span><span class="op">(</span><span class="va">tfm</span>, <span class="va">words</span>, valuetype <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># average among Hamilton/Madison essays</span></span>
<span><span class="va">tfm_ave</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_group.html">dfm_group</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/dfm_subset.html">dfm_subset</a></span><span class="op">(</span><span class="va">tfm</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">author</span><span class="op">)</span><span class="op">)</span>, groups <span class="op">=</span> <span class="va">author</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/docvars.html">docvars</a></span><span class="op">(</span><span class="va">tfm</span>, <span class="st">"author"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bind docvars from corpus and tfm to a data frame</span></span>
<span><span class="va">author_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="../../../reference/docvars.html">docvars</a></span><span class="op">(</span><span class="va">corpus_raw</span><span class="op">)</span>, <span class="fu"><a href="../../../reference/convert.html">convert</a></span><span class="op">(</span><span class="va">tfm</span>, to <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create numeric variable that takes value 1 for Hamilton's essays,</span></span>
<span><span class="co"># -1 for Madison's essays and NA for the essays with unknown authorship</span></span>
<span><span class="va">author_data</span><span class="op">$</span><span class="va">author_numeric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">author_data</span><span class="op">$</span><span class="va">author</span> <span class="op">==</span> <span class="st">"hamilton"</span>, <span class="fl">1</span>, </span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">author_data</span><span class="op">$</span><span class="va">author</span> <span class="op">==</span> <span class="st">"madison"</span>, <span class="op">-</span><span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use only known authors for training set</span></span>
<span><span class="va">author_data_known</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">author_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">author_numeric</span> <span class="op">~</span> <span class="va">upon</span> <span class="op">+</span> <span class="va">there</span> <span class="op">+</span> <span class="va">consequently</span> <span class="op">+</span> <span class="va">whilst</span>,</span>
<span>             data <span class="op">=</span> <span class="va">author_data_known</span><span class="op">)</span></span>
<span><span class="va">hm_fit</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = author_numeric ~ upon + there + consequently + whilst, </span></span>
<span><span class="co">##     data = author_data_known)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##  (Intercept)          upon         there  consequently        whilst  </span></span>
<span><span class="co">##      -0.2728        0.2240        0.1278       -0.5597       -0.8379</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hm_fitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">hm_fit</span><span class="op">)</span> <span class="co"># fitted values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">hm_fitted</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.7175463</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="section-5-1-5-cross-validation">Section 5.1.5: Cross-Validation<a class="anchor" aria-label="anchor" href="#section-5-1-5-cross-validation"></a>
</h2>
<p>Finally, we assess how well the model fits the data by classifying
each essay based on its fitted value.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># proportion of correctly classified essays by Hamilton</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">hm_fitted</span><span class="op">[</span><span class="va">author_data_known</span><span class="op">$</span><span class="va">author</span> <span class="op">==</span> <span class="st">"hamilton"</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># proportion of correctly classified essays by Madison</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">hm_fitted</span><span class="op">[</span><span class="va">author_data_known</span><span class="op">$</span><span class="va">author</span> <span class="op">==</span> <span class="st">"madison"</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">author_data_known</span><span class="op">)</span></span>
<span><span class="va">hm_classify</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">n</span><span class="op">)</span> <span class="co"># a container vector with missing values</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># fit the model to the data after removing the ith observation</span></span>
<span>  <span class="va">sub_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">author_numeric</span> <span class="op">~</span> <span class="va">upon</span> <span class="op">+</span> <span class="va">there</span> <span class="op">+</span> <span class="va">consequently</span> <span class="op">+</span> <span class="va">whilst</span>,</span>
<span>                data <span class="op">=</span> <span class="va">author_data_known</span><span class="op">[</span><span class="op">-</span><span class="va">i</span>, <span class="op">]</span><span class="op">)</span> <span class="co"># exclude ith row</span></span>
<span>  <span class="co"># predict the authorship for the ith observation</span></span>
<span>  <span class="va">hm_classify</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">sub_fit</span>, newdata <span class="op">=</span> <span class="va">author_data_known</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># proportion of correctly classified essays by Hamilton</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">hm_classify</span><span class="op">[</span><span class="va">author_data_known</span><span class="op">$</span><span class="va">author</span> <span class="op">==</span> <span class="st">"hamilton"</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># proportion of correctly classified essays by Madison</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">hm_classify</span><span class="op">[</span><span class="va">author_data_known</span><span class="op">$</span><span class="va">author</span> <span class="op">==</span> <span class="st">"madison"</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">disputed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">49</span>, <span class="fl">50</span><span class="op">:</span><span class="fl">57</span>, <span class="fl">62</span>, <span class="fl">63</span><span class="op">)</span> <span class="co"># 11 essays with disputed authorship</span></span>
<span><span class="va">tf_disputed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/dfm_subset.html">dfm_subset</a></span><span class="op">(</span><span class="va">tfm</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">author</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="../../../reference/convert.html">convert</a></span><span class="op">(</span>to <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">author_data</span><span class="op">$</span><span class="va">prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">hm_fit</span>, newdata <span class="op">=</span> <span class="va">author_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">author_data</span><span class="op">$</span><span class="va">prediction</span> <span class="co"># predicted values</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1]  0.73688561 -0.13805744 -1.35078839 -0.03818220 -0.27281185  0.71544514</span></span>
<span><span class="co">##  [7]  1.33186598  0.19419487  0.37522873 -0.20366262  0.67591728  0.99485942</span></span>
<span><span class="co">## [13]  1.39358870 -1.18910700  1.20454811  0.64005758  0.91397681 -0.38337508</span></span>
<span><span class="co">## [19] -0.62468302 -0.12449276  0.91560123  1.08105705  0.88535667  1.01199958</span></span>
<span><span class="co">## [25]  0.08231865  0.72345360  1.08185398  0.71361766  1.47727897  1.53681013</span></span>
<span><span class="co">## [31]  1.85581851  0.71928207  1.07671057  1.26171629  0.90807385  1.06348441</span></span>
<span><span class="co">## [37] -0.81827318 -0.56125155 -0.27281185 -0.10304108 -0.47339830 -0.17488801</span></span>
<span><span class="co">## [43] -0.60651986 -0.86943120 -1.67771035 -0.91485858 -0.13263458 -0.13495322</span></span>
<span><span class="co">## [49] -0.96785069 -0.06902493 -1.46794406 -0.27281185 -0.54226168 -0.54530152</span></span>
<span><span class="co">## [55]  0.04087236 -0.56414912 -1.18176926 -0.41900312  0.55206970  0.98683635</span></span>
<span><span class="co">## [61]  0.59244239 -0.97797908 -0.21198475 -0.18292385  1.15647955  1.12410607</span></span>
<span><span class="co">## [67]  0.78355251  0.11202677  1.12627538  0.70796660  0.34757045  0.84264937</span></span>
<span><span class="co">## [73]  1.24189733  0.91619843  0.50283000  1.05488104  1.05933797  0.90593132</span></span>
<span><span class="co">## [79]  0.54299626  0.64042173  0.91780877  0.31194485  0.80874960  0.73655199</span></span>
<span><span class="co">## [85]  1.00901860</span></span></code></pre>
<p>Finally, we plot the fitted values for each Federalist paper with the
<strong>ggplot2</strong> package.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">author_data</span><span class="op">$</span><span class="va">author_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">author_data</span><span class="op">$</span><span class="va">author</span><span class="op">)</span>, <span class="st">"unknown"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">author_data</span><span class="op">$</span><span class="va">author</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">author_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">paper_numeric</span>, </span>
<span>                               y <span class="op">=</span> <span class="va">prediction</span>, </span>
<span>                               shape <span class="op">=</span> <span class="va">author_plot</span>, </span>
<span>                               colour <span class="op">=</span> <span class="va">author_plot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Federalist Papers"</span>, y <span class="op">=</span> <span class="st">"Predicted values"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="qss_files/figure-html/unnamed-chunk-13-1.png" width="768"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kenneth Benoit, Kohei Watanabe, Haiyan Wang, Paul Nulty, Adam Obeng, Stefan Müller, Akitaka Matsuo, William Lowe, European Research Council.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '9b4ef7fd791dc6075154d3ebd7b12acf',
    indexName: 'quanteda',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
